<div class="mx-auto p-6 flex flex-row flex-wrap w-full gap-5">
  <div
    class="flex flex-row w-full max-md:flex-wrap gap-5 md:justify-center max-md:justify-between"
  >
    <mat-card class="shadow-lg p-6 lg:w-1/3 md:w-1/2 max-md:w-full">
      <h3 class="text-xl font-semibold mb-2 flex items-center gap-2">
        <mat-icon>countertops</mat-icon> Counter Feature
      </h3>
      <div class="flex flex-row items-center py-5 gap-5">
        <p class="text-lg font-medium text-gray-700">
          Counter: <span class="text-indigo-600 font-bold">{{ counter }}</span>
        </p>
        <button mat-raised-button (click)="increment()"><mat-icon>add</mat-icon>Increment</button>
      </div>
    </mat-card>

    <mat-card class="shadow-lg p-6 lg:w-1/3 md:w-1/2 max-md:w-full">
      <h3 class="text-xl font-semibold mb-3 flex items-center gap-2">
        <mat-icon>person</mat-icon> User Login
      </h3>
      @if (isLoggedIn) {

      <div class="space-y-3">
        <p class="text-green-600 font-medium">âœ… Welcome, {{ username }}!</p>
        <button mat-raised-button (click)="handleLogout()">
          <mat-icon>logout</mat-icon> Logout
        </button>
      </div>
      }@else{

      <div class="flex flex-col sm:flex-row sm:items-center gap-3 mb-2">
        <mat-form-field class="w-full sm:w-1/2">
          <mat-label>Username</mat-label>
          <input
            matInput
            [(ngModel)]="username"
            placeholder="Enter username"
            required
          />
        </mat-form-field>

        <button
          mat-raised-button
          color="primary"
          class="w-full sm:w-auto"
          (click)="handleLogin()"
        >
          <mat-icon>login</mat-icon> Login
        </button>
      </div>
      <p class="text-sm text-gray-500">
        Try logging in with a username (3+ chars)
      </p>
      }
    </mat-card>
  </div>

  <mat-card class="shadow-lg p-6 overflow-x-auto w-full">
    <h3 class="text-xl font-semibold mb-3 flex items-center gap-2">
      <mat-icon color="primary">shopping_cart</mat-icon>
      Shopping Cart
    </h3>

    <table mat-table [dataSource]="items" class="w-full">
      <!-- Item -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Item</th>
        <td mat-cell *matCellDef="let item">{{ item.name }}</td>
        <td
          mat-footer-cell
          *matFooterCellDef
          class="text-right font-medium"
          colspan="1"
        >
          Subtotal:
        </td>
      </ng-container>

      <!-- Price -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Price</th>
        <td mat-cell *matCellDef="let item">${{ item.price }}</td>
        <td mat-footer-cell *matFooterCellDef></td>
      </ng-container>

      <!-- Quantity -->
      <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef>Quantity</th>
        <td mat-cell *matCellDef="let item">
          <input
            type="number"
            class="w-16 border rounded-md p-1 text-center"
            [value]="item.quantity"
            min="0"
            (input)="updateQuantity(item.id, $any($event.target).value)"
          />
        </td>
        <td
          mat-footer-cell
          *matFooterCellDef
          class="font-semibold text-indigo-700 !pl-[40px]"
        >
          {{ totalQuantity }}
        </td>
      </ng-container>

      <!-- Subtotal -->
      <ng-container matColumnDef="subtotal">
        <th mat-header-cell *matHeaderCellDef>Subtotal</th>
        <td mat-cell *matCellDef="let item">
          ${{ (item.price * item.quantity).toFixed(2) }}
        </td>
        <td
          mat-footer-cell
          *matFooterCellDef
          class="font-semibold text-indigo-600"
        >
          ${{ total.toFixed(2) }}
        </td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let item">
          <button mat-icon-button color="warn" (click)="removeItem(item.id)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
        <td mat-footer-cell *matFooterCellDef></td>
      </ng-container>

      <!-- Header -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

      <!-- Body -->
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      <!-- Footer Row -->
      <tr
        mat-footer-row
        *matFooterRowDef="displayedColumns"
        class="bg-gray-100"
      ></tr>
    </table>

    <div class="flex justify-evenly flex-wrap items-center gap-4 mt-4">
      <div class="flex items-center gap-2">
        <mat-label>Discount (%)</mat-label>
        <input
          matInput
          type="number"
          [(ngModel)]="discount"
          min="0"
          max="100"
          class="border rounded-md p-1 w-20 text-center"
        />
      </div>
      <div class="text-lg font-semibold text-indigo-700">
        Final Total: ${{ finalTotal.toFixed(2) }}
      </div>
    </div>
  </mat-card>
</div>
